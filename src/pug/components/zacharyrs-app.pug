link(rel="import", href="../bower/iron-resizable-behavior/iron-resizable-behavior.html")
link(rel="import", href="../bower/app-layout/app-header/app-header.html")
link(rel="import", href="../bower/app-layout/app-toolbar/app-toolbar.html")
link(rel="import", href="../bower/paper-tabs/paper-tabs.html")
link(rel="import", href="../bower/iron-pages/iron-pages.html")
link(rel="import", href="../bower/app-route/app-location.html")
link(rel="import", href="../bower/app-route/app-route.html")
link(rel="import", href="../bower/polymerfire/polymerfire.html")
link(rel="import", href="../bower/polymerfire/firebase-document.html")

link(rel="import", href="zacharyrs-admin.html")
link(rel="import", href="zacharyrs-mobile-menu.html")
link(rel="import", href="zacharyrs-contactme.html")
link(rel="import", href="zacharyrs-aboutme.html")
link(rel="import", href="zacharyrs-404.html")
link(rel="import", href="zacharyrs-blog.html")
link(rel="import", href="zacharyrs-blogpost.html")
link(rel="import", href="zacharyrs-user.html")

link(rel="import", href="styles/zacharyrs-app.html")

dom-module#zacharyrs-app
  template
    style(is="custom-style", include="shared-styles").
      app-header {
        width: 100vw;
        height: 132px;
        color: #fff;
        transform: none !important;
        @apply(--layout-fixed-top);
        z-index: 1;
        background-color: rgba(255, 255, 255, 0.95);
        --app-header-shadow: {
          box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.2);
          height: 10px;
          bottom: -10px;
        };
      }

      paper-tabs {
        color: #656D78;
        --paper-tabs-selection-bar-color: var(--theme-light);
        margin: 0 20vw 0 20vw;
      }

      paper-tab {
        margin: 0 30px;
        font-size: 0.6cm;
      }

      :host {
        display: block;
        position: relative;
      }

      div#notice {
        box-sizing: border-box;
        max-height: 0;
        width: calc(96vw - 2 * 96vw / 3 * 0.05);
        margin: auto;
        margin-top: calc(142px + 96vw / 3 * 0.05);
        border-radius: 8px;
        background: url('/assets/img/crystal.png');
        background-size: cover;
        transition: max-height 0.3s;
        overflow: hidden;
        will-change: max-height;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.4);
      }

      div#notice p {
        padding: 8px;
        text-align: center;
        color: var(--theme-grey-light);
        font-weight: bold !important;
        font-size: 20px !important;
      }

      iron-pages {
        position: absolute;
        min-height:  calc(100vh - 142px);
        width: 100vw;
      }

      app-toolbar {
        margin-bottom: 20px;
      }

      app-toolbar.mobile {
        display: none;
      }

      #wrapper {
        position: absolute;
        width: 100vw;
        height: 100vh;
      }

      .scrollbar-track:hover {
        background: var(--theme-grey-light);
      }

      .scrollbar-thumb {
        background: var(--theme-dark);
      }

      @media handheld, only screen and (max-width: 1080px) {
        app-header {
          height: 82px;
        }

        iron-pages {
          padding-top: 0;
          height:  100vh;
        }

        app-toolbar {
          margin-bottom: 8px;
        }

        app-toolbar {
          display: none;
        }

        app-toolbar.mobile {
          display: initial;
        }

        div#notice {
          margin-top: calc(0px + 96vw / 2 * 0.05);
          width: calc(96vw - 2 * 96vw / 2 * 0.05);
        }
      }

      @media handheld, only screen and (max-width: 640px) {
        div#notice {
          margin-top: calc(0px + 96vw / 1 * 0.05);
          width: calc(96vw - 2 * 96vw / 1 * 0.05);
        }
      }

    firebase-app(
      name="zacharyrs",
      auth-domain="zacharyrs-me.firebaseapp.com",
      database-url="https://zacharyrs-me.firebaseio.com",
      api-key="AIzaSyCXJ2wFGr9hjKBbeGltrfuSQ8XoL06U8Tc",
      messaging-sender-id="591464613003"
    )

    app-location(route="{{route}}")
    app-route(
      route="{{route}}",
      pattern="/:page",
      data="{{data}}"
    )
    app-route(
      route="{{route}}",
      pattern="/post",
      tail="{{postRoute}}"
    )
    app-route(
      route="{{route}}",
      pattern="/user",
      tail="{{userRoute}}"
    )

    firebase-document(
      id="query",
      app-name="zacharyrs",
      path="/notification",
      data="{{notification}}"
    )

    app-header
      app-toolbar
        h2.logo.
          zacharyrs
      paper-tabs(
        attr-for-selected="name",
        selected="{{data.page}}",
        noink
      )
        paper-tab(name="blog").
          blog
        //- paper-tab(name="portfolio").
        //-   portfolio
        paper-tab(name="about").
          about me
        paper-tab(name="contact").
          contact me
    zacharyrs-mobile-menu(
      attr-for-selected="name",
      selected="{{data.page}}"
    )
      div(name="blog").
        blog
      //- div(name="portfolio").
      //-   portfolio
      div(name="about").
        about me
      div(name="contact").
        contact me
    div#wrapper(data-scrollbar)
      app-toolbar.mobile
        h2.logo.
          zacharyrs
      div#notice
        p.
          [[notification]]
      iron-pages(
        selected="[[data.page]]",
        attr-for-selected="name",
        selected-attribute="visible",
        fallback-selection="not-found"
      )
        zacharyrs-blog(name="blog")
        zacharyrs-blogpost(name="post", route="{{postRoute}}")
        zacharyrs-user(name="user", route="{{userRoute}}")
        //- div(name="portfolio").
        //-   PORTFOLIO APP HERE
        zacharyrs-aboutme(name="about")
        zacharyrs-contactme(name="contact")
        zacharyrs-404(name="not-found")
        zacharyrs-admin(name="admin", signed-in="[[signedIn]]")
  script(type="text/javascript").
      'use strict';

      class HomePage {
          get behaviors() {
              return [Polymer.IronResizableBehavior];
          }

          beforeRegister() {
              this.is = 'zacharyrs-app';
              this.properties = {};
              this.observers = [
                  '_onRoutePathChanged(route.path)',
                  '_showNotification(notification)'
              ];
              this.listeners = {
                  'iron-resize': '_reRender'
              };
          }
          created() {}
          ready() {
              const scrollbar = Scrollbar.init(document.getElementById('wrapper'), {'speed':0.8, 'overscrollEffect':'bounce', 'overscrollDamping':0.2});
              for (let i of document.querySelectorAll('.scrollbar-track, .scrollbar-thumb, .scrollbar-content')) {
                  i.classList.add('zacharyrs-app');
              }
              scrollbar.addListener((status) => {
                  console.log(status.direction.y, status.offset.y === 0, status.offset.y === status.limit.y); //- Set up to add and remove header classes
              })
          }
          attached() {}
          detached() {}
          attributeChanged() {}

          _reRender() {
              Polymer.updateStyles();
          }

          _onRoutePathChanged(path) {
              if (!path || path == '/') {
                  this.set('route.path', '/blog');
              };
          };

          _showNotification(notification) {
              if((typeof notification === 'string' || notification instanceof String) && notification != "") {
                  this.$.notice.style.maxHeight = '400px';
              } else {
                  this.$.notice.style.maxHeight = '0px';
              }
          }
      }

      Polymer(HomePage);
