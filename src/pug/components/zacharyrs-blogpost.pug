link(rel="import", href="../bower/iron-flex-layout/iron-flex-layout-classes.html")
link(rel="import", href="../bower/iron-ajax/iron-ajax.html")
link(rel="import", href="../bower/app-route/app-route.html")

link(rel="import", href="styles/zacharyrs-app.html")
link(rel="import", href="zacharyrs-blogbox.html")

dom-module#zacharyrs-blogpost
  template
    style(is="custom-style", include="shared-styles iron-flex").
      .container {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        margin: 0 2vw 0 2vw;
      }

      zacharyrs-blogbox {
        --width: calc(96vw);
        --height: calc(96vw);
      }
    app-route(
      route="{{route}}",
      pattern="/:postId/:postName",
      data="{{data}}"
    )
    iron-ajax#blog-data(
      auto
      url="/assets/data/blogfill.json",
      method="GET",
      content-type="application/json",
      handle-as="json",
      last-response="{{blog-data}}"
    )
    section.container
      template(is="dom-repeat", items="{{blog-data}}")
        template(is="dom-if", if="[[_checkPostId(item)]]")
          zacharyrs-blogbox(post="[[item]]")
  script(type="text/javascript").
      'use strict';

      class BlogPost {
          beforeRegister() {
              this.is = 'zacharyrs-blogpost';
              this.properties = {};
              this.observers = [
                  '_onRoutePathChanged(route.path)'
              ];
          }
          created() {}
          ready() {}
          attached() {}
          detached() {}
          attributeChanged() {}

          _checkPostId(post) {
              return this.data.postId === post.id;
          }

          _onRoutePathChanged(path) {
              document.getElementById('blog-data').generateRequest();
          };
      }

      Polymer(BlogPost);
